# 批量TXT文件内容替换功能实现计划（支持多条替换规则）

## 📋 实现概述
参考现有的"批量文件翻译"页面设计，创建一个新的"批量文本替换"功能，支持多条替换规则，按顺序依次替换。

## 🎯 实现步骤

### 1. 创建新的Vue组件 - `BatchTextReplace.vue`
**文件位置**: `src/components/BatchTextReplace.vue`

**组件结构**:
```vue
<template>
  <div class="batch-text-replace">
    <div class="card">
      <h2 class="card-title">🔄 批量文本替换</h2>
      
      <!-- 替换规则区域 - 支持多条规则 -->
      <div class="replace-rules-section">
        <div class="rules-header">
          <span>替换规则</span>
          <button @click="addRule" class="add-rule-btn">+ 添加规则</button>
        </div>
        
        <div class="rules-list">
          <div 
            v-for="(rule, index) in rules" 
            :key="index" 
            class="rule-item"
          >
            <div class="rule-number">规则 {{ index + 1 }}</div>
            <div class="rule-inputs">
              <div class="input-group">
                <label>被替换内容</label>
                <textarea 
                  v-model="rule.searchText" 
                  placeholder="输入要查找的文本..."
                  rows="2"
                ></textarea>
              </div>
              <div class="input-group">
                <label>替换为</label>
                <textarea 
                  v-model="rule.replaceText" 
                  placeholder="输入替换后的文本..."
                  rows="2"
                ></textarea>
              </div>
            </div>
            <button @click="removeRule(index)" class="remove-rule-btn" v-if="rules.length > 1">
              🗑️
            </button>
          </div>
        </div>
        
        <!-- 规则管理按钮 -->
        <div class="rule-actions">
          <button @click="saveRules">保存规则</button>
          <button @click="loadRules">加载规则</button>
          <button @click="clearRules">清空规则</button>
        </div>
      </div>
      
      <!-- 文件上传区域 -->
      <div class="file-upload-section">
        <div class="upload-buttons">
          <button @click="selectFiles">选择文件</button>
          <button @click="selectFolder">选择文件夹</button>
        </div>
        
        <div v-if="selectedFiles.length > 0" class="file-list">
          <div class="file-list-header">
            <span>已选择 {{ selectedFiles.length }} 个文件</span>
            <button @click="clearFiles">清空</button>
          </div>
          <div class="file-items">
            <div v-for="(file, index) in selectedFiles" :key="index" class="file-item">
              <span>{{ file }}</span>
              <button @click="removeFile(index)">×</button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 保存选项 -->
      <div class="save-options">
        <div class="option-group">
          <label>
            <input type="radio" v-model="saveMode" value="replace">
            <span>替换原文件</span>
          </label>
          <label>
            <input type="radio" v-model="saveMode" value="save_as">
            <span>另存为新文件</span>
          </label>
        </div>
        
        <div class="save-path-selector" :class="{ disabled: saveMode === 'replace' }">
          <label>保存路径：</label>
          <div class="path-display">{{ savePath || '未选择' }}</div>
          <button @click="selectSavePath" :disabled="saveMode === 'replace'">
            选择文件夹
          </button>
        </div>
      </div>
      
      <!-- 执行按钮 -->
      <div class="replace-action">
        <button 
          @click="startReplace" 
          :disabled="selectedFiles.length === 0 || !hasValidRules || isReplacing || (saveMode === 'save_as' && !savePath)"
        >
          {{ isReplacing ? '替换中...' : '开始替换' }}
        </button>
      </div>
      
      <!-- 进度显示 -->
      <div v-if="replaceProgress.total > 0" class="progress-section">
        <div class="progress-bar">
          <div class="progress-fill" :style="{ width: replaceProgress.percent + '%' }"></div>
        </div>
        <div class="progress-text">
          {{ replaceProgress.current }} / {{ replaceProgress.total }} ({{ replaceProgress.percent }}%)
        </div>
      </div>
    </div>
  </div>
</template>
```

**核心功能**:
- **多条替换规则管理**
  - 默认显示一条规则
  - 点击"+ 添加规则"按钮添加新规则
  - 每条规则包含"被替换内容"和"替换为"两个输入框
  - 可以删除规则（至少保留一条）
  - 规则按顺序依次执行替换
  
- **文件选择**（单个/多个文件、文件夹扫描）
- **保存模式选择**（替换原文件/另存为新文件）
- **替换规则保存/加载**（使用localStorage）
- **进度显示和状态反馈**
- **错误处理和异常捕获**

### 2. 更新 App.vue 添加新标签页
**修改文件**: `src/App.vue`

**修改内容**:
- 导入新组件 `BatchTextReplace`
- 在 `tabs` 数组中添加新标签:
  ```javascript
  { id: 'replace', label: '批量文本替换', component: BatchTextReplace, icon: '🔄' }
  ```
- 在 `components` 中注册新组件

### 3. 样式设计
**参考 BatchFileReplace.vue 的样式**，确保：
- 与现有设计风格一致
- 响应式布局（支持移动端）
- 进度条动画效果
- 按钮hover效果
- 暗色/浅色主题支持
- 规则列表样式（每条规则独立卡片）

### 4. 功能特性

**替换规则管理**:
- 保存规则到 localStorage（最多保存最近10组规则）
- 加载历史规则（下拉选择）
- 清空规则功能
- 规则验证（至少有一条有效规则）

**文件处理**:
- 复用现有的 Rust 命令：`read_file_content`、`write_file_content`、`join_path`
- 支持大文件处理（使用分块处理避免卡顿）
- 文件编码检测（UTF-8）
- 按规则顺序依次替换

**进度反馈**:
- 实时显示当前文件和总文件数
- 进度百分比显示
- 完成后显示成功/失败统计

**错误处理**:
- 文件读取失败提示
- 替换操作失败提示
- 不支持的文件类型过滤

## 📁 文件清单
1. **新建**: `src/components/BatchTextReplace.vue` (约700行)
2. **修改**: `src/App.vue` (添加新标签页导入和注册)

## ✅ 验证点
- 侧边栏显示"批量文本替换"按钮
- 默认显示一条替换规则
- 可以点击"+ 添加规则"按钮添加更多规则
- 每条规则都有"被替换内容"和"替换为"输入框
- 可以删除规则（至少保留一条）
- 可以选择多个TXT文件
- 可以选择替换模式（替换/另存）
- 替换过程显示进度
- 大文件处理不卡顿
- 错误提示清晰
- 响应式设计正常工作